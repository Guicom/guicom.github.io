version: '2'
services:
  # web with xdebug - actency images
  web:
    # @see https://github.com/Actency/docker-apache-php
    image: actency/docker-apache-php:7.2
    ports:
      - "80:80"
      #- "9001:9000"
    environment:
      - SERVERNAME=socomec.com.loc
      - SERVERALIAS=socomec.com.loc
      - DOCUMENTROOT=web
      - DRUSH_VERSION=9
    volumes:
      - /home/docker/projets/socomec/:/var/www/html
      - /home/docker/projets/socomec/:/var/www/.ssh/
      - /home/docker/projets/socomec/config/.bashrc:/var/www/.bashrc
    links:
      - database:mysql
      - mailhog
      - redis
      - solr
      - tika
    tty: true
    shm_size: 2G
    extra_hosts:
      - "socomec.com.loc:127.0.0.1"
      - "docker_host:10.10.10.254" # YOUR IP HERE
    hostname: "socomec.com.loc"

  # database container - actency images
  database:
    # @see https://github.com/Actency/docker-mysql
    image: actency/docker-mysql:5.7
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=mysqlroot
      - MYSQL_DATABASE=socomec_com
      - MYSQL_USER=mysqlusr
      - MYSQL_PASSWORD=mysqlpwd

  # phpmyadmin container - actency images
  phpmyadmin:
    image: actency/docker-phpmyadmin
    ports:
      - "8010:80"
    environment:
      - MYSQL_ROOT_PASSWORD=mysqlroot
      - UPLOAD_SIZE=1G
    links:
      - database:mysql

  # mailhog container - official images
  mailhog:
    image: mailhog/mailhog
    ports:
      - "1025:1025"
      - "8025:8025"

  # redis container - official images
  redis:
    image: redis:latest
    ports:
      - "6379:6739"

  # phpRedisAdmin container - actency images
  phpredisadmin:
    image: actency/docker-phpredisadmin
    ports:
      - "9900:80"
    environment:
      - REDIS_1_HOST=redis
    links:
      - redis

  # varnish v4 container - No official image exists, using the most used one.
  varnish:
    image: million12/varnish
    volumes:
      - ./config/varnish/default.vcl:/etc/varnish/custom.vcl
    ports:
      - "80"
    links:
      - web:web-backend
    environment:
      - VCL_CONFIG=/etc/varnish/custom.vcl
      - VARNISHD_PARAMS=-p default_ttl=3600 -p default_grace=3600 -p http_max_hdr=512

  # solr container - actency images
  solr:
    # actency/docker-solr available tags: latest, 6.2, 6.1, 6.0, 5.5, 5.4, 5.3, 5.2, 5.1, 5.0, 4.10, 3.6
    image: actency/docker-solr:6.2
    ports:
      - "8080:8983"
    volumes:
      - ./config/solr:/opt/solr/server/solr/collection1/conf

  # Tika server container - actency images
  tika:
    image: actency/docker-tika-server
    ports:
      - "9998:9998"

  browser:
    image: selenium/standalone-chrome:3.14.0-europium
    ports:
      - "4444:4444"
    shm_size: 2G
    links:
      - web
